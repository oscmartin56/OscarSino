server {
    # 1. PUERTO DE ESCUCHA
    # Nginx escucha en el puerto 80 del contenedor. Este puerto será mapeado 
    # (por docker-compose) al puerto 8000 de tu máquina local.
    listen 80;

    # 2. NOMBRE DEL SERVIDOR
    server_name localhost;

    # 3. DIRECTORIO RAÍZ
    # El servidor debe apuntar al directorio 'public' de Laravel, que es el punto de entrada
    # de la aplicación (donde reside el index.php principal).
    root /var/www/html/public;
    
    # 4. ARCHIVOS DE ÍNDICE
    index index.php;

    # 5. MANEJO DE RUTAS (FAIL-OVER LARAVEL)
    # Este bloque maneja cualquier petición de URL.
    location / {
        # Intenta servir la URI tal cual (ej. un archivo CSS o imagen),
        # o si es un directorio, busca un archivo de índice.
        try_files $uri $uri/ 
        
        # Si no encuentra el archivo estático, pasa la petición al index.php de Laravel. 
        # Esto es lo que permite que el routing de Laravel funcione para todas las URLs amigables.
        /index.php?$query_string;
    }

    # 6. PROCESAMIENTO PHP (FASTCGI)
    # Este bloque maneja peticiones que terminan en .php (incluyendo las redirecciones de la línea 5).
    location ~ \.php$ {
        # ¡CRUCIAL! Pasa la petición al servicio PHP-FPM (el contenedor de tu backend).
        # 'app' es el nombre del servicio PHP que definiste en docker-compose.yml.
        # :9000 es el puerto estándar de PHP-FPM.
        fastcgi_pass app:9000;
        
        # Indica el archivo de índice FastCGI.
        fastcgi_index index.php;
        
        # Le dice a PHP-FPM cuál es el archivo de script que debe ejecutar.
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        
        # Incluye los parámetros estándar necesarios para la comunicación FastCGI.
        include fastcgi_params;
    }
}